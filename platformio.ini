; 
; Configurazione PlatformIO per ESP32 MQTT DHT11 Monitor
; 
; Questo file configura l'ambiente di sviluppo per il progetto ESP32
; con supporto per sensore DHT11 e comunicazione MQTT
;
; Autore: ESP32-MQTT Guide
; Versione: 1.0.0

[platformio]
default_envs = esp32dev

; ==================== CONFIGURAZIONE ESP32 ====================

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; Velocità di comunicazione seriale
monitor_speed = 115200

; ==================== LIBRERIE RICHIESTE ====================

lib_deps = 
    ; Libreria per sensore DHT11/DHT22
    adafruit/DHT sensor library@^1.4.4
    adafruit/Adafruit Unified Sensor@^1.1.9
    
    ; Libreria MQTT client
    knolleary/PubSubClient@^2.8
    
    ; Libreria per gestione JSON
    bblanchon/ArduinoJson@^6.21.3
    
    ; Librerie WiFi (incluse nel core ESP32)
    ; WiFi.h - già inclusa nel framework
    ; WiFiClientSecure.h - per connessioni TLS

; ==================== CONFIGURAZIONE BUILD ====================

; Definizioni del preprocessore
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DARDUINOJSON_ENABLE_PROGMEM=1
    -DMQTT_MAX_PACKET_SIZE=512
    -DPUBSUBCLIENT_BUFFER_SIZE=512

; Ottimizzazioni del compilatore
build_unflags = 
    -Os
build_flags = 
    ${env:esp32dev.build_flags}
    -O2

; ==================== CONFIGURAZIONE UPLOAD ====================

; Velocità di upload (può essere ridotta in caso di problemi)
upload_speed = 921600

; Porta seriale (auto-detection)
; upload_port = /dev/ttyUSB0     ; Linux
; upload_port = COM3             ; Windows
; upload_port = /dev/cu.SLAB_USBtoUART  ; macOS

; ==================== CONFIGURAZIONE MONITOR ====================

; Filtri per il monitor seriale
monitor_filters = 
    esp32_exception_decoder
    time

; Flag per il monitor
monitor_flags = 
    --quiet
    --echo

; ==================== CONFIGURAZIONE AVANZATA ====================

; Partizione personalizzata (opzionale)
; board_build.partitions = partitions.csv

; Configurazione flash
board_build.filesystem = spiffs
board_build.flash_mode = dio

; Configurazione memoria
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L

; ==================== AMBIENTE DI TEST ====================

[env:esp32dev_debug]
extends = env:esp32dev
build_type = debug
build_flags = 
    ${env:esp32dev.build_flags}
    -DDEBUG_ESP_PORT=Serial
    -DDEBUG_ESP_CORE
    -DDEBUG_ESP_WIFI
    -DDEBUG_ESP_HTTP_CLIENT
    -g

; ==================== AMBIENTE DI PRODUZIONE ====================

[env:esp32dev_release]
extends = env:esp32dev
build_flags = 
    -Os
    -DNDEBUG
    -DARDUINOJSON_ENABLE_PROGMEM=1
    -DMQTT_MAX_PACKET_SIZE=256

; ==================== CONFIGURAZIONE PER DIVERSI BOARD ====================

; ESP32 DevKit V1
[env:esp32doit-devkit-v1]
extends = env:esp32dev
board = esp32doit-devkit-v1

; ESP32 WROOM-32
[env:esp32-wroom-32]
extends = env:esp32dev  
board = esp32-wroom-32

; ESP32-S2
[env:esp32-s2]
extends = env:esp32dev
board = esp32-s2-saola-1
platform = espressif32

; ESP32-C3
[env:esp32-c3]
extends = env:esp32dev
board = esp32-c3-devkitm-1
platform = espressif32

; ==================== TASK PERSONALIZZATI ====================

; Task per pulire completamente il progetto
[env:clean]
extends = env:esp32dev
extra_scripts = 
    pre:scripts/clean_all.py